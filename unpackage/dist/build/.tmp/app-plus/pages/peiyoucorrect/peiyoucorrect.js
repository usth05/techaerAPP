(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/peiyoucorrect/peiyoucorrect"],{"199a":function(t,i,e){"use strict";e.r(i);var o=e("d0ea"),s=e("5058");for(var n in s)"default"!==n&&function(t){e.d(i,t,function(){return s[t]})}(n);e("47c8");var a=e("2877"),r=Object(a["a"])(s["default"],o["a"],o["b"],!1,null,"c3f2b564",null);i["default"]=r.exports},"440c":function(t,i,e){},"47c8":function(t,i,e){"use strict";var o=e("440c"),s=e.n(o);s.a},5058:function(t,i,e){"use strict";e.r(i);var o=e("a47b"),s=e.n(o);for(var n in o)"default"!==n&&function(t){e.d(i,t,function(){return o[t]})}(n);i["default"]=s.a},a47b:function(t,i,e){"use strict";(function(t,o){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=function(){return e.e("components/uni-card/uni-card").then(e.bind(null,"4ca0"))},n=t.getRecorderManager(),a=t.createInnerAudioContext();a.autoplay=!0;var r={components:{uniCard:s},data:function(){return{listData:[],token:"",userDictationaId:-1,lookObj:{},isLook:!1,correctionType:0,name:"",imageUrl:"",dataUrl:"",videoUrl:"",imgArr:[],isPrompt:!1,tabIndex:0,isRecord:!1,voicePath:"",isPlayShow:!1,isPlay:!1,isRevise:!1}},onLoad:function(t){var i=this,e=this,o={hz:"content"};this.$imgOss.getParam(o),n.onStop(function(t){e.voicePath=t.tempFilePath,e.audioUrl=t.tempFilePath,this.isPlayShow=!0}),a.onEnded(function(t){i.isPlay=!1}),this.token=t.token,this.userDictationaId=t.id;var s="manageHabit/selectHabitCorrection.json",r={userDictationaId:this.userDictationaId,token:this.token,enable:1};this.uniHttp.getJSON(s,r,function(t){if(t.data.success){var e=t.data.data;if(null!=e)if(i.listData=[],i.isRevise=!0,i.listData.push(e),0==e.correctionType||1==e.correctionType){var o=[];o.push(e.videoUrl),e.imgArr=o}else if(2==e.correctionType){var s=[];if(e.videoUrl){var n={img:e.photoUrl,video:e.videoUrl};s.push(n)}e.videoArr=s}}})},onNavigationBarButtonTap:function(t){0==t.index&&(plus.nativeUI.showWaiting(),this.verification())},methods:{verification:function(){if(""==this.name)return plus.nativeUI.toast("标题不能为空"),void plus.nativeUI.closeWaiting();if(0==this.correctionType){if(!this.imgArr[0])return plus.nativeUI.toast("请先添加上传的图片"),void plus.nativeUI.closeWaiting();this.upFile("$imgOss",this.imgArr[0],"dataUrl",!0)}else if(1==this.correctionType){if(!this.voicePath)return plus.nativeUI.toast("请先录制音频"),void plus.nativeUI.closeWaiting();this.upFile("$imgOss",this.voicePath,"dataUrl",!0)}else if(2==this.correctionType){if(!this.videoUrl)return plus.nativeUI.toast("请先添加上传的视频"),void plus.nativeUI.closeWaiting();this.upFile("$imgOss",this.imgArr[0],"imageUrl",!1),this.upFile("$videoOss",this.videoUrl,"dataUrl",!0)}},send:function(){var i;i=this.isRevise?"manageHabit/updateHabitCorrection.json":"manageHabit/insertHabitCorrection.json";var e={userDictationaId:this.userDictationaId,token:this.token,enable:1,name:this.name,photoUrl:this.imageUrl,videoUrl:this.dataUrl,correctionType:this.correctionType};this.isRevise&&(e.id=this.listData[0].id),this.uniHttp.getJSON(i,e,function(i){i.data.success?(plus.nativeUI.toast("发布成功"),t.navigateBack({delta:1})):plus.nativeUI.toast(i.data.msg),plus.nativeUI.closeWaiting()},function(t){plus.nativeUI.toast("发布失败")})},upFile:function(t,i,e,s){var n=this;this[t].getJSON(i,function(t){if(200==t.status){if(n[e]=t.url,!s)return!1;n.send()}else plus.nativeUI.toast(i+"文件上传失败")},function(t){console.log(o("run"," at pages\\peiyoucorrect\\peiyoucorrect.vue:279"))})},record:function(t){t?(this.endRecord(),this.isRecord=!1):(this.startRecord(),this.isRecord=!0)},startRecord:function(){plus.nativeUI.toast("开始录音"),n.start({format:"mp3"})},endRecord:function(){plus.nativeUI.toast("录音结束"),this.isPlayShow=!0,n.stop()},playVoice:function(t){t?(a.pause(),this.isPlay=!1):(a.src=this.voicePath,a.play(),this.isPlay=!0)},uploadImg:function(){var i=this;t.chooseImage({count:1,sizeType:["original","compressed"],success:function(t){i.imgArr=t.tempFilePaths}})},uploadVideo:function(){var i=this;0==this.imgArr.length?t.showToast({type:"none",title:"请先上传视频封面"}):t.chooseVideo({count:1,sourceType:["camera","album"],success:function(t){i.videoUrl=t.tempFilePath}})},deleteImg:function(t){this.imgArr.splice(t,1)},tapPrompt:function(t){""!=this.name||0!=this.imgArr.length||""!=this.voicePath||""!=this.videoUrl?(this.tabIndex=t,this.isPrompt=!0):this.tapBar(t)},tapClose:function(){this.isPrompt=!1},tapBar:function(t){var i,e;0==t?i={hz:"content"}:1==t?i={hz:"voice"}:2==t&&(e={hz:"video"},i={hz:"content"},this.$videoOss.getParam(e)),this.$imgOss.getParam(i),this.correctionType=t,this.name="",this.imgArr=[],this.voicePath="",this.videoUrl="",this.isPlay=!1,this.isRecord=!1,this.tapClose()},lookImg:function(i,e){t.previewImage({current:e,urls:i})},lookVideo:function(t,i,e,o){this.lookObj.index==e&&this.lookObj.i==o?this.isLook=!1:(this.isLook=!0,this.lookObj.index=e,this.lookObj.i=o),this.isLook?(this.lookObj.img=t,this.lookObj.video=i):(this.lookObj={},this.lookObj.index=-1,this.lookObj.i=-1)},close:function(){this.isLook=!1,this.lookObj={}},tabPi:function(i){t.navigateTo({url:"../peiyoucorrect/peiyoucorrect?id="+i.id})}}};i.default=r}).call(this,e("6e42")["default"],e("0de9")["default"])},d0ea:function(t,i,e){"use strict";var o=function(){var t=this,i=t.$createElement;t._self._c},s=[];e.d(i,"a",function(){return o}),e.d(i,"b",function(){return s})},f9d1:function(t,i,e){"use strict";(function(t){e("5223"),e("921b");o(e("66fd"));var i=o(e("199a"));function o(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("6e42")["createPage"])}},[["f9d1","common/runtime","common/vendor"]]]);